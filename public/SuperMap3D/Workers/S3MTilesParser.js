define(["./createTaskProcessorWorker","./ComponentDatatype-3cfb1146","./Color-75231487","./getStringFromTypedArray-1f235117","./S3MEdgeProcessor-35fba258","./Cartesian3-c1138337","./Cartographic-630e5de6","./PrimitiveType-3f9684f7","./S3MPixelFormat-56c14909","./pako_inflate-e5e032ee","./defaultValue-2110bb17","./Check-92c551fb","./WebGLConstants-92042d9e","./FeatureDetection-e7fb956a","./Math-cd1437d9","./defer-a21481c0","./RuntimeError-6daf0e01","./IndexDatatype-d833345d","./Cartesian4-5c264813"],(function(t,e,r,n,a,i,o,E,s,y,u,p,T,l,v,d,A,c,_){"use strict";function f(t,e,r,n,a,i){this.left=t,this.bottom=e,this.right=r,this.top=n,this.minHeight=a,this.maxHeight=i,this.width=r-t,this.length=n-e,this.height=i-a}function m(t,r,n,s,y,u,p,T){var l=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var v=0,d={},A=d.vertexAttributes=[],c=d.attrLocation={};d.instanceCount=0,d.instanceMode=0;var _=0;u.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT;var f=u.getUint16(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var m=f;f>4&&(m=f>>8,f&=15);var B=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var g=void 0,P=void 0;if(B>0){var U=u.getUint16(p,!0);U=f*Float32Array.BYTES_PER_ELEMENT,p+=Uint32Array.BYTES_PER_ELEMENT,v=B*U;var L=y.subarray(p,p+v);if(s||n){var h=new i.o,M=new i.o,S=new Float32Array(L.buffer,L.byteOffset,L.byteLength/4),N=new o.a;g=new o.a,P=new o.a;for(var R=new Float32Array(4*B),D=new Float64Array(2*B),Y=0;Y<B;Y++)E.y.multiplyByPoint(r,i.o.fromElements(S[4*Y],S[4*Y+1],S[4*Y+2],h),M),N=o.a.fromCartesian(M),D[2*Y]=N.longitude,D[2*Y+1]=N.latitude,0===Y?(g.longitude=N.longitude,g.latitude=N.latitude,P.longitude=N.longitude,P.latitude=N.latitude):(g.longitude=Math.max(N.longitude,g.longitude),g.latitude=Math.max(N.latitude,g.latitude),P.longitude=Math.min(N.longitude,P.longitude),P.latitude=Math.min(N.latitude,P.latitude));var I=n?g.longitude-P.longitude:1,x=n?g.latitude-P.latitude:1;for(Y=0;Y<B;Y++)R[4*Y]=D[2*Y]-P.longitude,R[4*Y+1]=D[2*Y+1]-P.latitude,R[4*Y+2]=(D[2*Y]-P.longitude)/I,R[4*Y+3]=(D[2*Y+1]-P.latitude)/x;c.aRelativeGeoCoord=_,A.push({index:c.aRelativeGeoCoord,typedArray:R,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:4*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),_++}c.aPosition=_,A.push({index:c.aPosition,typedArray:L,componentsPerAttribute:f,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:U,normalize:!1}),_++,p+=v}var F=u.getUint32(p,!0);if(p+=Uint32Array.BYTES_PER_ELEMENT,F>0){var b=u.getUint16(p,!0);b=m*Float32Array.BYTES_PER_ELEMENT,p+=Uint32Array.BYTES_PER_ELEMENT,v=F*b;let r=new Float32Array(y.buffer,p,3),n=0===r[0]&&0===r[1]&&0===r[2];t.ignoreNormal||n||(c.aNormal=_,A.push({index:c.aNormal,typedArray:y.subarray(p,p+v),componentsPerAttribute:m,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:b,normalize:!1}),_++),p+=v}var C=u.getUint32(p,!0);if(p+=Uint32Array.BYTES_PER_ELEMENT,C>0){var w=new Uint8Array(4*C);T.push(w.buffer);var O=u.getUint32(p,!0);O=4*Float32Array.BYTES_PER_ELEMENT,p+=Uint32Array.BYTES_PER_ELEMENT,v=C*O;for(var k=new Float32Array(y.buffer,p,4*B),z=0;z<B;z++)w[4*z]=255*k[4*z],w[4*z+1]=255*k[4*z+1],w[4*z+2]=255*k[4*z+2],w[4*z+3]=255*k[4*z+3];p+=v,c.aColor=_,A.push({index:c.aColor,typedArray:w,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),_++}var G=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT,G>0&&(p+=v=16*G);var H=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var V,W,X=-1,j=0;j<H;j++){V=u.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT,W=u.getUint16(p,!0),p+=Uint16Array.BYTES_PER_ELEMENT,u.getUint16(p,!0),p+=Uint16Array.BYTES_PER_ELEMENT,v=V*W*Float32Array.BYTES_PER_ELEMENT;var q,J=y.subarray(p,p+v);if(-1!=X||20!=W&&35!=W)if(-1!==X)d.instanceBounds=new Float32Array(y.buffer,p,V*W);else{var K="aTexCoord"+j;c[K]=_++,A.push({index:c[K],typedArray:J,componentsPerAttribute:W,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:W*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}else X=j,d.instanceCount=V,d.instanceMode=W,d.instanceBuffer=J,20===W?(q=20*Float32Array.BYTES_PER_ELEMENT,c.uv2=_++,A.push({index:c.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:q,instanceDivisor:1}),c.uv3=_++,A.push({index:c.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv4=_++,A.push({index:c.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.secondary_colour=_++,A.push({index:c.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv6=_++,A.push({index:c.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1})):35===W&&(q=35*Float32Array.BYTES_PER_ELEMENT,c.uv1=_++,A.push({index:c.uv1,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:q,instanceDivisor:1,byteLength:v}),c.uv2=_++,A.push({index:c.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv3=_++,A.push({index:c.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv4=_++,A.push({index:c.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv5=_++,A.push({index:c.uv5,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv6=_++,A.push({index:c.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv7=_++,A.push({index:c.uv7,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.secondary_colour=_++,A.push({index:c.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),c.uv9=_++,A.push({index:c.uv9,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}));p+=v}d.verticesCount=B,d.instanceIndex=X;var Q=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Z,$=[];for(j=0;j<Q;j++){var tt={},et=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var rt=u.getUint8(p,!0);p+=Uint8Array.BYTES_PER_ELEMENT,u.getUint8(p,!0),p+=Uint8Array.BYTES_PER_ELEMENT;var nt=u.getUint8(p,!0);p+=Uint8Array.BYTES_PER_ELEMENT,p+=1,tt.indicesCount=et,tt.indexType=rt,tt.primitiveType=nt;var at=p;et>0&&(0==rt?(p+=v=et*Uint16Array.BYTES_PER_ELEMENT,et%2==1&&(p+=2)):p+=v=4*et),tt.indicesTypedArray=y.subarray(at,at+v);var it=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var ot=u.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT*it,tt.materialCode=ot,$.push(tt)}let Et;return 2===$.length&&13===$[1].primitiveType&&$[1].indicesCount>=3&&(Z=a._0x5c13c5.createEdgeDataByIndices(d,$[1],T)),void 0!==g&&void 0!==P&&(Et={max:g,min:P}),t[l]={vertexPackage:d,arrIndexPackage:$,edgeGeometry:Z,cartographicBounds:Et},p}function B(t,r,n){var a=t.vertexAttributes,i=t.attrLocation,o=a.length;i[1===n?"instanceId":"batchId"]=o,a.push({index:o,typedArray:r,componentsPerAttribute:1,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:n})}return new r.e,t((function(t,e){var r=t.buffer,i=t.supportCompressType,o=t.bVolume,E=null,p=null,T=null,l=t.isCoverImageryLayer,v=t.coveredMap,d=t.modelMatrix;if(o&&t.volbuffer.byteLength<8&&(o=!1),o){var A=t.volbuffer,c=new Uint8Array(A,8),_=y.pako.inflate(c).buffer,g=new Float64Array(_,0,1),P=new Uint32Array(_,48,1);if(0===g[0]||3200===P[0]||3201===P[0]){var U=0;0===g[0]&&(U=8),e.push(_);var L=new Float64Array(_,U,6),h=L[0],M=L[1],S=L[2],N=L[3],R=L[4]<L[5]?L[4]:L[5],D=L[4]>L[5]?L[4]:L[5];p={left:h,top:M,right:S,bottom:N,minHeight:R,maxHeight:D,width:(E=new f(h,N,S,M,R,D)).width,length:E.length,height:E.height};var Y=new Uint32Array(_,48+U,7),I=Y[0],x=Y[1],F=Y[2],b=Y[3];T={nFormat:I,nSideBlockCount:x,nBlockLength:F,nLength:b,nWidth:Y[4],nHeight:Y[5],nDepth:Y[6],imageArray:new Uint8Array(_,76+U,b*b*4)}}}var C=0,w=new Uint8Array(r,0,4);if(115!==w[0]||51!==w[1]||109!==w[2])return{result:!1};var O=w[3],k=(c=new Uint8Array(r,4),y.pako.inflate(c).buffer),z=new Uint8Array(k);e.push(z.buffer);var G=new DataView(k),H=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var V=new Uint8Array(k,C,H),W=H%4;W&&(W=4-W),C+=H+W;var X=n.a(V,void 0,void 0,"gbk");X=(X=X.replace(new RegExp("\r\n","gm"),"")).replace(new RegExp(":","gm"),""),G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var j=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var q={};q.ignoreNormal=t.ignoreNormal;for(var J=0;J<j;J++)C=m(q,d,v,l,z,G,C,e);G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var K=G.getUint32(C,!0);for(C+=Uint32Array.BYTES_PER_ELEMENT,J=0;J<K;J++){var Q=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Z=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var $={},tt=q[Q].vertexPackage.instanceIndex,et=q[Q].edgeGeometry;if(-1==tt){for(var rt=new Float32Array(q[Q].vertexPackage.verticesCount),nt=0;nt<Z;nt++){var at=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var it=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var ot=0,Et=0;$[at]={batchId:nt};for(var st=0;st<it;st++)if(Et=G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT,ot=G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT,rt.fill)rt.fill(nt,Et,Et+ot);else for(var yt=Et+Et,ut=Et;ut<yt;ut++)rt[ut]=nt;$[at].vertexColorOffset=Et,$[at].vertexColorCount=ot}B(q[Q].vertexPackage,rt,void 0)}else{var pt=q[Q].vertexPackage.instanceCount;q[Q].vertexPackage.instanceBuffer,q[Q].vertexPackage.instanceMode;var Tt=new Float32Array(pt),lt=0;for(nt=0;nt<Z;nt++){at=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;it=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;for(st=0;st<it;st++){var vt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT,Tt[lt]=lt,void 0===$[at]&&($[at]={vertexColorCount:1,instanceIds:[],vertexColorOffset:lt}),$[at].instanceIds.push(vt),lt++}}B(q[Q].vertexPackage,Tt,1)}q[Q].pickInfo=$;et=q[Q].edgeGeometry;if(u.e(et)){var dt,At,ct=et.regular.instancesData,_t=a._0x5c13c5.RegularInstanceStride;if(u.e(ct))for(At=ct.length,dt=0;dt<At;dt+=_t){var ft=ct[dt+9];ct[dt+9]=rt[ft]}var mt=et.silhouette.instancesData;if(_t=a._0x5c13c5.SilhouetteInstanceStride,u.e(mt))for(At=mt.length,dt=0;dt<At;dt+=_t){ft=mt[dt+12];mt[dt+12]=rt[ft]}}}G.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var Bt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var gt={};for(J=0;J<Bt;J++){var Pt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Ut=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Lt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var ht=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;it=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Mt=G.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var St=null;if(ht===a.S3MCompressType.enrS3TCDXTN&&1!==i){var Nt=null;Mt>s.S3MPixelFormat.BGR||Mt===s.S3MPixelFormat.LUMINANCE_ALPHA?(Nt=new Uint8Array(k,C,Ut*Lt),St=new Uint8Array(Ut*Lt*4)):(Nt=new Uint16Array(k,C,it/2),St=new Uint16Array(Ut*Lt)),a.L.decode(St,Ut,Lt,Nt,Mt),e.push(St.buffer),ht=0}else St=new Uint8Array(k,C,it);gt[Pt]={id:Pt,width:Ut,height:Lt,compressType:ht,nFormat:Mt,imageBuffer:St},C+=it}return{result:!0,version:O,xmlDoc:X,geoPackage:q,texturePackage:gt,volImageBuffer:T,volBounds:p}}))}));
