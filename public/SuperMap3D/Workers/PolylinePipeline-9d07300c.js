define(["exports","./Cartesian3-c1138337","./Cartographic-630e5de6","./defaultValue-2110bb17","./Check-92c551fb","./Ellipsoid-ca2b8eb1","./EllipsoidGeodesic-262ae711","./EllipsoidRhumbLine-89d13f20","./IntersectionTests-c1fbbeaa","./Math-cd1437d9","./PrimitiveType-3f9684f7","./Plane-32891d32"],(function(e,r,a,t,n,o,i,c,s,u,h,l){"use strict";var f={numberOfPoints:function(e,a,t){var n=r.o.distance(e,a);return Math.ceil(n/t)},numberOfPointsRhumbLine:function(e,r,a){var t=Math.pow(e.longitude-r.longitude,2)+Math.pow(e.latitude-r.latitude,2);return t=Math.max(t,u.e.EPSILON21),Math.ceil(Math.sqrt(t/(a*a)))}},g=new a.a;f.extractHeights=function(e,r){for(var a=e.length,t=new Array(a),n=0;n<a;n++){var o=e[n];t[n]=r.cartesianToCartographic(o,g).height}return t};var p=new h.y,v=new r.o,d=new r.o,m=new l.o(r.o.UNIT_X,0),w=new r.o,y=new l.o(r.o.UNIT_X,0),T=new r.o,P=new r.o,A=[];function b(e,r,a){var t,n=A;if(n.length=e,r===a){for(t=0;t<e;t++)n[t]=r;return n}var o=(a-r)/e;for(t=0;t<e;t++){var i=r+t*o;n[t]=i}return n}var C=new a.a,S=new a.a,E=new r.o,R=new r.o,D=new r.o,N=new i.E,G=new c.P;function I(e,a,t,n,o,i,c,s,u){var h=n.scaleToGeodeticSurface(e,R),l=n.scaleToGeodeticSurface(a,D),g=f.numberOfPoints(e,a,t),p=n.cartesianToCartographic(h,C),v=n.cartesianToCartographic(l,S),d=b(g,o,i);u>0&&(d=function(e,r){var a=A;a.length=e;for(var t=0;t<e;t++)a[t]+=r*Math.sin(Math.PI*t/e);return a}(g,u)),N.setEndPoints(p,v);var m=N.surfaceDistance/g,w=s;p.height=o;var y=n.cartographicToCartesian(p,E);r.o.pack(y,c,w),w+=3;for(var T=1;T<g;T++){var P=N.interpolateUsingSurfaceDistance(T*m,S);P.height=d[T],y=n.cartographicToCartesian(P,E),r.o.pack(y,c,w),w+=3}return w}function M(e,a,t,n,o,i,s,u){var h=n.scaleToGeodeticSurface(e,R),l=n.scaleToGeodeticSurface(a,D),g=n.cartesianToCartographic(h,C),p=n.cartesianToCartographic(l,S),v=f.numberOfPointsRhumbLine(g,p,t),d=b(v,o,i);G.ellipsoid.equals(n)||(G=new c.P(void 0,void 0,n)),G.setEndPoints(g,p);var m=G.surfaceDistance/v,w=u;g.height=o;var y=n.cartographicToCartesian(g,E);r.o.pack(y,s,w),w+=3;for(var T=1;T<v;T++){var P=G.interpolateUsingSurfaceDistance(T*m,S);P.height=d[T],y=n.cartographicToCartesian(P,E),r.o.pack(y,s,w),w+=3}return w}f.wrapLongitude=function(e,a){var n=[],o=[];if(t.e(e)&&e.length>0){a=t.u(a,h.y.IDENTITY);var i=h.y.inverseTransformation(a,p),c=h.y.multiplyByPoint(i,r.o.ZERO,v),u=r.o.normalize(h.y.multiplyByPointAsVector(i,r.o.UNIT_Y,d),d),f=l.o.fromPointNormal(c,u,m),g=r.o.normalize(h.y.multiplyByPointAsVector(i,r.o.UNIT_X,w),w),A=l.o.fromPointNormal(c,g,y),b=1;n.push(r.o.clone(e[0]));for(var C=n[0],S=e.length,E=1;E<S;++E){var R=e[E];if(l.o.getPointDistance(A,C)<0||l.o.getPointDistance(A,R)<0){var D=s.g.lineSegmentPlane(C,R,f,T);if(t.e(D)){var N=r.o.multiplyByScalar(u,5e-9,P);l.o.getPointDistance(f,C)<0&&r.o.negate(N,N),n.push(r.o.add(D,N,new r.o)),o.push(b+1),r.o.negate(N,N),n.push(r.o.add(D,N,new r.o)),b=1}}n.push(r.o.clone(e[E])),b++,C=R}o.push(b)}return{positions:n,lengths:o}},f.generateArc=function(e){t.e(e)||(e={});var a=e.positions;if(!t.e(a))throw new n.t("options.positions is required.");var i=a.length,c=t.u(e.ellipsoid,o.t.WGS84),s=t.u(e.height,0),h=Array.isArray(s);if(i<1)return[];if(1===i){var l=c.scaleToGeodeticSurface(a[0],R);if(0!==(s=h?s[0]:s)){var g=c.geodeticSurfaceNormal(l,E);r.o.multiplyByScalar(g,s,g),r.o.add(l,g,l)}return[l.x,l.y,l.z]}var p=e.minDistance;if(!t.e(p)){var v=t.u(e.granularity,u.e.RADIANS_PER_DEGREE);p=u.e.chordLength(v,c.maximumRadius)}var d,m=0;for(d=0;d<i-1;d++)m+=f.numberOfPoints(a[d],a[d+1],p);var w=e.hMax,y=3*(m+1),T=new Array(y),P=0;for(d=0;d<i-1;d++){P=I(a[d],a[d+1],p,c,h?s[d]:s,h?s[d+1]:s,T,P,w)}A.length=0;var b=a[i-1],S=c.cartesianToCartographic(b,C);S.height=h?s[i-1]:s;var D=c.cartographicToCartesian(S,E);return r.o.pack(D,T,y-3),T};var k=new a.a,O=new a.a;f.generateRhumbArc=function(e){t.e(e)||(e={});var i=e.positions;if(!t.e(i))throw new n.t("options.positions is required.");var c=i.length,s=t.u(e.ellipsoid,o.t.WGS84),h=t.u(e.height,0),l=Array.isArray(h);if(c<1)return[];if(1===c){var g=s.scaleToGeodeticSurface(i[0],R);if(0!==(h=l?h[0]:h)){var p=s.geodeticSurfaceNormal(g,E);r.o.multiplyByScalar(p,h,p),r.o.add(g,p,g)}return[g.x,g.y,g.z]}var v,d,m=t.u(e.granularity,u.e.RADIANS_PER_DEGREE),w=0,y=s.cartesianToCartographic(i[0],k);for(v=0;v<c-1;v++)d=s.cartesianToCartographic(i[v+1],O),w+=f.numberOfPointsRhumbLine(y,d,m),y=a.a.clone(d,k);var T=3*(w+1),P=new Array(T),b=0;for(v=0;v<c-1;v++){b=M(i[v],i[v+1],m,s,l?h[v]:h,l?h[v+1]:h,P,b)}A.length=0;var S=i[c-1],D=s.cartesianToCartographic(S,C);D.height=l?h[c-1]:h;var N=s.cartographicToCartesian(D,E);return r.o.pack(N,P,T-3),P},f.generateCartesianArc=function(e){for(var a=f.generateArc(e),t=a.length/3,n=new Array(t),o=0;o<t;o++)n[o]=r.o.unpack(a,3*o);return n},f.generateCartesianRhumbArc=function(e){for(var a=f.generateRhumbArc(e),t=a.length/3,n=new Array(t),o=0;o<t;o++)n[o]=r.o.unpack(a,3*o);return n},e.m=f}));
