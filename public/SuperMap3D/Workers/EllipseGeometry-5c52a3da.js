define(["exports","./arrayFill-c1a6b724","./buildModuleUrl-b49ab279","./Ellipsoid-ca2b8eb1","./Cartesian3-c1138337","./Cartographic-630e5de6","./Check-92c551fb","./ComponentDatatype-3cfb1146","./defaultValue-2110bb17","./EllipseGeometryLibrary-d0f7249b","./GeometryAttribute-36384495","./GeometryAttributes-3cad3ff9","./GeometryInstance-b6ed0a94","./GeometryOffsetAttribute-da5a1d35","./GeometryPipeline-c4eb0d48","./IndexDatatype-d833345d","./Math-cd1437d9","./FeatureDetection-e7fb956a","./PrimitiveType-3f9684f7","./Rectangle-52f780a9","./VertexFormat-295b1d1f"],(function(t,e,o,r,n,i,a,s,u,m,l,p,c,d,y,f,h,A,x,g,_){"use strict";var v=new n.o,b=new n.o,w=new n.o,I=new n.o,T=new r.o,N=new A.p,M=new A.p,E=new l.n,P=new n.o,D=new n.o,F=new n.o,O=new i.a,S=new n.o,C=new r.o,R=new r.o;function L(t,i,a){var c=i.vertexFormat,y=i.center,f=i.semiMajorAxis,h=i.semiMinorAxis,x=i.ellipsoid,g=i.stRotation,_=a?t.length/3*2:t.length/3,I=i.shadowVolume,L=c.st?new Float32Array(2*_):void 0,j=c.normal?new Float32Array(3*_):void 0,z=c.tangent?new Float32Array(3*_):void 0,V=c.bitangent?new Float32Array(3*_):void 0,G=I?new Float32Array(3*_):void 0,k=0,Y=P,B=D,H=F,U=new o.n(x),W=U.project(x.cartesianToCartographic(y,O),S),q=x.scaleToGeodeticSurface(y,v);x.geodeticSurfaceNormal(q,q);var Q=N,J=M;if(0!==g){var Z=l.n.fromAxisAngle(q,g,E);Q=A.p.fromQuaternion(Z,Q),Z=l.n.fromAxisAngle(q,-g,E),J=A.p.fromQuaternion(Z,J)}else Q=A.p.clone(A.p.IDENTITY,Q),J=A.p.clone(A.p.IDENTITY,J);for(var K=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,C),X=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,R),$=t.length,tt=a?$:0,et=tt/3*2,ot=0;ot<$;ot+=3){var rt=ot+1,nt=ot+2,it=n.o.fromArray(t,ot,v);if(c.st){var at=A.p.multiplyByVector(Q,it,b),st=U.project(x.cartesianToCartographic(at,O),w);n.o.subtract(st,W,st),T.x=(st.x+f)/(2*f),T.y=(st.y+h)/(2*h),K.x=Math.min(T.x,K.x),K.y=Math.min(T.y,K.y),X.x=Math.max(T.x,X.x),X.y=Math.max(T.y,X.y),a&&(L[k+et]=T.x,L[k+1+et]=T.y),L[k++]=T.x,L[k++]=T.y}(c.normal||c.tangent||c.bitangent||I)&&(Y=x.geodeticSurfaceNormal(it,Y),I&&(G[ot+tt]=-Y.x,G[rt+tt]=-Y.y,G[nt+tt]=-Y.z),(c.normal||c.tangent||c.bitangent)&&((c.tangent||c.bitangent)&&(B=n.o.normalize(n.o.cross(n.o.UNIT_Z,Y,B),B),A.p.multiplyByVector(J,B,B)),c.normal&&(j[ot]=Y.x,j[rt]=Y.y,j[nt]=Y.z,a&&(j[ot+tt]=-Y.x,j[rt+tt]=-Y.y,j[nt+tt]=-Y.z)),c.tangent&&(z[ot]=B.x,z[rt]=B.y,z[nt]=B.z,a&&(z[ot+tt]=-B.x,z[rt+tt]=-B.y,z[nt+tt]=-B.z)),c.bitangent&&(H=n.o.normalize(n.o.cross(Y,B,H),H),V[ot]=H.x,V[rt]=H.y,V[nt]=H.z,a&&(V[ot+tt]=H.x,V[rt+tt]=H.y,V[nt+tt]=H.z))))}if(c.st){$=L.length;for(var ut=0;ut<$;ut+=2)L[ut]=(L[ut]-K.x)/(X.x-K.x),L[ut+1]=(L[ut+1]-K.y)/(X.y-K.y)}var mt=new p.a;if(c.position){var lt=m.C.raisePositionsToHeight(t,i,a);mt.position=new l.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:lt})}if(c.st&&(mt.st=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L})),c.normal&&(mt.normal=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),c.tangent&&(mt.tangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),c.bitangent&&(mt.bitangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),I&&(mt.extrudeDirection=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),a&&u.e(i.offsetAttribute)){var pt=new Uint8Array(_);if(i.offsetAttribute===d.z.TOP)pt=e.d(pt,1,0,_/2);else{var ct=i.offsetAttribute===d.z.NONE?0:1;pt=e.d(pt,ct)}mt.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:pt})}return mt}function j(t){var e,o,r,n,i,a=new Array(t*(t+1)*12-6),s=0;for(e=0,r=1,n=0;n<3;n++)a[s++]=r++,a[s++]=e,a[s++]=r;for(n=2;n<t+1;++n){for(r=n*(n+1)-1,e=(n-1)*n-1,a[s++]=r++,a[s++]=e,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;a[s++]=r++,a[s++]=e,a[s++]=r}for(o=2*t,++r,++e,n=0;n<o-1;++n)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;for(a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e++,a[s++]=e,++e,n=t-1;n>1;--n){for(a[s++]=e++,a[s++]=e,a[s++]=r,o=2*n,i=0;i<o-1;++i)a[s++]=r,a[s++]=e++,a[s++]=e,a[s++]=r++,a[s++]=e,a[s++]=r;a[s++]=e++,a[s++]=e++,a[s++]=r++}for(n=0;n<3;n++)a[s++]=e++,a[s++]=e,a[s++]=r;return a}var z=new n.o;var V=new o.i,G=new o.i;function k(t){var i=t.center,a=t.ellipsoid,h=t.semiMajorAxis,g=n.o.multiplyByScalar(a.geodeticSurfaceNormal(i,v),t.height,v);V.center=n.o.add(i,g,V.center),V.radius=h,g=n.o.multiplyByScalar(a.geodeticSurfaceNormal(i,g),t.extrudedHeight,g),G.center=n.o.add(i,g,G.center),G.radius=h;var _=m.C.computeEllipsePositions(t,!0,!0),M=_.positions,z=_.numPts,k=_.outerPositions,Y=o.i.union(V,G),B=L(M,t,!0),H=j(z),U=H.length;H.length=2*U;for(var W=M.length/3,q=0;q<U;q+=3)H[q+U]=H[q+2]+W,H[q+1+U]=H[q+1]+W,H[q+2+U]=H[q]+W;var Q=f.IndexDatatype.createTypedArray(2*W/3,H),J=new l.I({attributes:B,indices:Q,primitiveType:x._0x4a8d51.TRIANGLES}),Z=function(t,i){var a=i.vertexFormat,m=i.center,c=i.semiMajorAxis,y=i.semiMinorAxis,f=i.ellipsoid,h=i.height,x=i.extrudedHeight,g=i.stRotation,_=t.length/3*2,M=new Float64Array(3*_),L=a.st?new Float32Array(2*_):void 0,j=a.normal?new Float32Array(3*_):void 0,z=a.tangent?new Float32Array(3*_):void 0,V=a.bitangent?new Float32Array(3*_):void 0,G=i.shadowVolume,k=G?new Float32Array(3*_):void 0,Y=0,B=P,H=D,U=F,W=new o.n(f),q=W.project(f.cartesianToCartographic(m,O),S),Q=f.scaleToGeodeticSurface(m,v);f.geodeticSurfaceNormal(Q,Q);for(var J=l.n.fromAxisAngle(Q,g,E),Z=A.p.fromQuaternion(J,N),K=r.o.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,C),X=r.o.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,R),$=t.length,tt=$/3*2,et=0;et<$;et+=3){var ot,rt=et+1,nt=et+2,it=n.o.fromArray(t,et,v);if(a.st){var at=A.p.multiplyByVector(Z,it,b),st=W.project(f.cartesianToCartographic(at,O),w);n.o.subtract(st,q,st),T.x=(st.x+c)/(2*c),T.y=(st.y+y)/(2*y),K.x=Math.min(T.x,K.x),K.y=Math.min(T.y,K.y),X.x=Math.max(T.x,X.x),X.y=Math.max(T.y,X.y),L[Y+tt]=T.x,L[Y+1+tt]=T.y,L[Y++]=T.x,L[Y++]=T.y}it=f.scaleToGeodeticSurface(it,it),ot=n.o.clone(it,b),B=f.geodeticSurfaceNormal(it,B),G&&(k[et+$]=-B.x,k[rt+$]=-B.y,k[nt+$]=-B.z);var ut=n.o.multiplyByScalar(B,h,I);if(it=n.o.add(it,ut,it),ut=n.o.multiplyByScalar(B,x,ut),ot=n.o.add(ot,ut,ot),a.position&&(M[et+$]=ot.x,M[rt+$]=ot.y,M[nt+$]=ot.z,M[et]=it.x,M[rt]=it.y,M[nt]=it.z),a.normal||a.tangent||a.bitangent){U=n.o.clone(B,U);var mt=n.o.fromArray(t,(et+3)%$,I);n.o.subtract(mt,it,mt);var lt=n.o.subtract(ot,it,w);B=n.o.normalize(n.o.cross(lt,mt,B),B),a.normal&&(j[et]=B.x,j[rt]=B.y,j[nt]=B.z,j[et+$]=B.x,j[rt+$]=B.y,j[nt+$]=B.z),a.tangent&&(H=n.o.normalize(n.o.cross(U,B,H),H),z[et]=H.x,z[rt]=H.y,z[nt]=H.z,z[et+$]=H.x,z[et+1+$]=H.y,z[et+2+$]=H.z),a.bitangent&&(V[et]=U.x,V[rt]=U.y,V[nt]=U.z,V[et+$]=U.x,V[rt+$]=U.y,V[nt+$]=U.z)}}if(a.st){$=L.length;for(var pt=0;pt<$;pt+=2)L[pt]=(L[pt]-K.x)/(X.x-K.x),L[pt+1]=(L[pt+1]-K.y)/(X.y-K.y)}var ct=new p.a;if(a.position&&(ct.position=new l.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:M})),a.st&&(ct.st=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L})),a.normal&&(ct.normal=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),a.tangent&&(ct.tangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),a.bitangent&&(ct.bitangent=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),G&&(ct.extrudeDirection=new l.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),u.e(i.offsetAttribute)){var dt=new Uint8Array(_);if(i.offsetAttribute===d.z.TOP)dt=e.d(dt,1,0,_/2);else{var yt=i.offsetAttribute===d.z.NONE?0:1;dt=e.d(dt,yt)}ct.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:dt})}return ct}(k,t);H=function(t){for(var e=t.length/3,o=f.IndexDatatype.createTypedArray(e,6*e),r=0,n=0;n<e;n++){var i=n,a=n+e,s=(i+1)%e,u=s+e;o[r++]=i,o[r++]=a,o[r++]=s,o[r++]=s,o[r++]=a,o[r++]=u}return o}(k);var K=f.IndexDatatype.createTypedArray(2*k.length/3,H),X=new l.I({attributes:Z,indices:K,primitiveType:x._0x4a8d51.TRIANGLES}),$=y.k.combineInstances([new c.d({geometry:J}),new c.d({geometry:X})]);return{boundingSphere:Y,attributes:$[0].attributes,indices:$[0].indices}}function Y(t,e,o,r,i,a,s){for(var u=m.C.computeEllipsePositions({center:t,semiMajorAxis:e,semiMinorAxis:o,rotation:r,granularity:i},!1,!0).outerPositions,l=u.length/3,p=new Array(l),c=0;c<l;++c)p[c]=n.o.fromArray(u,3*c);var d=g.h.fromCartesianArray(p,a,s);return d.width>h.e.PI&&(d.north=d.north>0?h.e.PI_OVER_TWO-h.e.EPSILON7:d.north,d.south=d.south<0?h.e.EPSILON7-h.e.PI_OVER_TWO:d.south,d.east=h.e.PI,d.west=-h.e.PI),d}function B(t){var e=(t=u.u(t,u.u.EMPTY_OBJECT)).center,o=u.u(t.ellipsoid,r.t.WGS84),i=t.semiMajorAxis,s=t.semiMinorAxis,m=u.u(t.granularity,h.e.RADIANS_PER_DEGREE),l=u.u(t.vertexFormat,_.n.DEFAULT);if(a.o.defined("options.center",e),a.o.typeOf.number("options.semiMajorAxis",i),a.o.typeOf.number("options.semiMinorAxis",s),i<s)throw new a.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new a.t("granularity must be greater than zero.");var p=u.u(t.height,0),c=u.u(t.extrudedHeight,p);this._center=n.o.clone(e),this._semiMajorAxis=i,this._semiMinorAxis=s,this._ellipsoid=r.t.clone(o),this._rotation=u.u(t.rotation,0),this._stRotation=u.u(t.stRotation,0),this._height=Math.max(c,p),this._granularity=m,this._vertexFormat=_.n.clone(l),this._extrudedHeight=Math.min(c,p),this._shadowVolume=u.u(t.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}B.packedLength=n.o.packedLength+r.t.packedLength+_.n.packedLength+9,B.pack=function(t,e,o){return a.o.defined("value",t),a.o.defined("array",e),o=u.u(o,0),n.o.pack(t._center,e,o),o+=n.o.packedLength,r.t.pack(t._ellipsoid,e,o),o+=r.t.packedLength,_.n.pack(t._vertexFormat,e,o),o+=_.n.packedLength,e[o++]=t._semiMajorAxis,e[o++]=t._semiMinorAxis,e[o++]=t._rotation,e[o++]=t._stRotation,e[o++]=t._height,e[o++]=t._granularity,e[o++]=t._extrudedHeight,e[o++]=t._shadowVolume?1:0,e[o]=u.u(t._offsetAttribute,-1),e};var H=new n.o,U=new r.t,W=new _.n,q={center:H,ellipsoid:U,vertexFormat:W,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};B.unpack=function(t,e,o){a.o.defined("array",t),e=u.u(e,0);var i=n.o.unpack(t,e,H);e+=n.o.packedLength;var s=r.t.unpack(t,e,U);e+=r.t.packedLength;var m=_.n.unpack(t,e,W);e+=_.n.packedLength;var l=t[e++],p=t[e++],c=t[e++],d=t[e++],y=t[e++],f=t[e++],h=t[e++],A=1===t[e++],x=t[e];return u.e(o)?(o._center=n.o.clone(i,o._center),o._ellipsoid=r.t.clone(s,o._ellipsoid),o._vertexFormat=_.n.clone(m,o._vertexFormat),o._semiMajorAxis=l,o._semiMinorAxis=p,o._rotation=c,o._stRotation=d,o._height=y,o._granularity=f,o._extrudedHeight=h,o._shadowVolume=A,o._offsetAttribute=-1===x?void 0:x,o):(q.height=y,q.extrudedHeight=h,q.granularity=f,q.stRotation=d,q.rotation=c,q.semiMajorAxis=l,q.semiMinorAxis=p,q.shadowVolume=A,q.offsetAttribute=-1===x?void 0:x,new B(q))},B.computeRectangle=function(t,e){var o=(t=u.u(t,u.u.EMPTY_OBJECT)).center,n=u.u(t.ellipsoid,r.t.WGS84),i=t.semiMajorAxis,s=t.semiMinorAxis,m=u.u(t.granularity,h.e.RADIANS_PER_DEGREE),l=u.u(t.rotation,0);if(a.o.defined("options.center",o),a.o.typeOf.number("options.semiMajorAxis",i),a.o.typeOf.number("options.semiMinorAxis",s),i<s)throw new a.t("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(m<=0)throw new a.t("granularity must be greater than zero.");return Y(o,i,s,l,m,n,e)},B.createGeometry=function(t){if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0)){var r=t._height,i=t._extrudedHeight,a=!h.e.equalsEpsilon(r,i,0,h.e.EPSILON2);t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center);var p,c={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:r,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation};if(a)c.extrudedHeight=i,c.shadowVolume=t._shadowVolume,c.offsetAttribute=t._offsetAttribute,p=k(c);else if(p=function(t){var e=t.center;z=n.o.multiplyByScalar(t.ellipsoid.geodeticSurfaceNormal(e,z),t.height,z),z=n.o.add(e,z,z);var r=new o.i(z,t.semiMajorAxis),i=m.C.computeEllipsePositions(t,!0,!1),a=i.positions,s=i.numPts,u=L(a,t,!1),l=j(s);return{boundingSphere:r,attributes:u,indices:l=f.IndexDatatype.createTypedArray(a.length/3,l)}}(c),u.e(t._offsetAttribute)){var y=p.attributes.position.values.length,A=new Uint8Array(y/3),g=t._offsetAttribute===d.z.NONE?0:1;e.d(A,g),p.attributes.applyOffset=new l.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:A})}return new l.I({attributes:p.attributes,indices:p.indices,primitiveType:x._0x4a8d51.TRIANGLES,boundingSphere:p.boundingSphere,offsetAttribute:t._offsetAttribute})}},B.createShadowVolume=function(t,e,o){var r=t._granularity,n=t._ellipsoid,i=e(r,n),a=o(r,n);return new B({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:n,rotation:t._rotation,stRotation:t._stRotation,granularity:r,extrudedHeight:i,height:a,vertexFormat:_.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(B.prototype,{rectangle:{get:function(){return u.e(this._rectangle)||(this._rectangle=Y(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return u.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];for(var o=m.C.computeEllipsePositions({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,rotation:t._rotation,granularity:t._granularity},!1,!0).outerPositions,r=o.length/3,i=new Array(r),a=0;a<r;++a)i[a]=n.o.fromArray(o,3*a);var s=t._ellipsoid,u=t.rectangle;return l.I._textureCoordinateRotationPoints(i,e,s,u)}(this)),this._textureCoordinateRotationPoints}}}),t.Y=B}));
