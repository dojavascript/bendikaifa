define(["./AttributeCompression-79e23de9","./Cartesian3-c1138337","./Cartographic-630e5de6","./Color-75231487","./defaultValue-2110bb17","./Ellipsoid-ca2b8eb1","./IndexDatatype-d833345d","./Math-cd1437d9","./OrientedBoundingBox-0440dece","./Rectangle-52f780a9","./createTaskProcessorWorker","./Check-92c551fb","./FeatureDetection-e7fb956a","./defer-a21481c0","./WebGLConstants-92042d9e","./buildModuleUrl-b49ab279","./PrimitiveType-3f9684f7","./Cartesian4-5c264813","./RuntimeError-6daf0e01","./Event-589349b0","./EllipsoidTangentPlane-716b5ef7","./IntersectionTests-c1fbbeaa","./Plane-32891d32","./GeometryAttribute-36384495","./PolygonPipeline-701444e0","./ComponentDatatype-3cfb1146","./EllipsoidRhumbLine-89d13f20"],(function(e,r,t,a,n,o,i,f,s,d,c,u,h,l,p,b,g,y,v,I,m,w,x,A,E,N,T){"use strict";var k=new r.o,L=new o.t,P=new d.h,C={min:void 0,max:void 0,indexBytesPerElement:void 0};function U(e,r,t){var n=r.length,o=2+n*s.p.packedLength+1+function(e){for(var r=e.length,t=0,n=0;n<r;++n)t+=a.e.packedLength+3+e[n].batchIds.length;return t}(t),i=new Float64Array(o),f=0;i[f++]=e,i[f++]=n;for(var d=0;d<n;++d)s.p.pack(r[d],i,f),f+=s.p.packedLength;var c=t.length;i[f++]=c;for(var u=0;u<c;++u){var h=t[u];a.e.pack(h.color,i,f),f+=a.e.packedLength,i[f++]=h.offset,i[f++]=h.count;var l=h.batchIds,p=l.length;i[f++]=p;for(var b=0;b<p;++b)i[f++]=l[b]}return i}var O=new r.o,F=new r.o,B=new r.o,D=new r.o,S=new r.o,R=new t.a,_=new d.h;return c((function(c,u){var h;!function(e){var t=new Float64Array(e),a=0;C.indexBytesPerElement=t[a++],C.min=t[a++],C.max=t[a++],r.o.unpack(t,a,k),a+=r.o.packedLength,o.t.unpack(t,a,L),a+=o.t.packedLength,d.h.unpack(t,a,P)}(c.packedBuffer),h=2===C.indexBytesPerElement?new Uint16Array(c.indices):new Uint32Array(c.indices);var l,p,b,g=new Uint16Array(c.positions),y=new Uint32Array(c.counts),v=new Uint32Array(c.indexCounts),I=new Uint32Array(c.batchIds),m=new Uint32Array(c.batchTableColors),w=new Array(y.length),x=k,A=L,E=P,N=C.min,T=C.max,G=c.minimumHeights,M=c.maximumHeights;n.e(G)&&n.e(M)&&(G=new Float32Array(G),M=new Float32Array(M));var V=g.length/2,Y=g.subarray(0,V),H=g.subarray(V,2*V);e.t.zigZagDeltaDecode(Y,H);var W=new Float32Array(3*V);for(l=0;l<V;++l){var z=Y[l],Z=H[l],j=f.e.lerp(E.west,E.east,z/32767),q=f.e.lerp(E.south,E.north,Z/32767),J=t.a.fromRadians(j,q,0,R),K=A.cartographicToCartesian(J,O);r.o.pack(K,W,3*l)}var Q=y.length,X=new Array(Q),$=new Array(Q),ee=0,re=0;for(l=0;l<Q;++l)X[l]=ee,$[l]=re,ee+=y[l],re+=v[l];var te,ae=new Float32Array(3*V*2),ne=new Uint16Array(2*V),oe=new Uint32Array($.length),ie=new Uint32Array(v.length),fe=[],se={};for(l=0;l<Q;++l)b=m[l],n.e(se[b])?(se[b].positionLength+=y[l],se[b].indexLength+=v[l],se[b].batchIds.push(l)):se[b]={positionLength:y[l],indexLength:v[l],offset:0,indexOffset:0,batchIds:[l]};var de=0,ce=0;for(b in se)if(se.hasOwnProperty(b)){(te=se[b]).offset=de,te.indexOffset=ce;var ue=2*te.positionLength,he=2*te.indexLength+6*te.positionLength;de+=ue,ce+=he,te.indexLength=he}var le=[];for(b in se)se.hasOwnProperty(b)&&(te=se[b],le.push({color:a.e.fromRgba(parseInt(b)),offset:te.indexOffset,count:te.indexLength,batchIds:te.batchIds}));for(l=0;l<Q;++l){var pe=(te=se[b=m[l]]).offset,be=3*pe,ge=pe,ye=X[l],ve=y[l],Ie=I[l],me=N,we=T;n.e(G)&&n.e(M)&&(me=G[l],we=M[l]);var xe=Number.POSITIVE_INFINITY,Ae=Number.NEGATIVE_INFINITY,Ee=Number.POSITIVE_INFINITY,Ne=Number.NEGATIVE_INFINITY;for(p=0;p<ve;++p){var Te=r.o.unpack(W,3*ye+3*p,O);A.scaleToGeodeticSurface(Te,Te);var ke=A.cartesianToCartographic(Te,R),Le=ke.latitude,Pe=ke.longitude;xe=Math.min(Le,xe),Ae=Math.max(Le,Ae),Ee=Math.min(Pe,Ee),Ne=Math.max(Pe,Ne);var Ce=A.geodeticSurfaceNormal(Te,F),Ue=r.o.multiplyByScalar(Ce,me,B),Oe=r.o.add(Te,Ue,D);Ue=r.o.multiplyByScalar(Ce,we,Ue);var Fe=r.o.add(Te,Ue,S);r.o.subtract(Fe,x,Fe),r.o.subtract(Oe,x,Oe),r.o.pack(Fe,ae,be),r.o.pack(Oe,ae,be+3),ne[ge]=Ie,ne[ge+1]=Ie,be+=6,ge+=2}(E=_).west=Ee,E.east=Ne,E.south=xe,E.north=Ae,w[l]=s.p.fromRectangle(E,N,T,A);var Be=te.indexOffset,De=$[l],Se=v[l];for(oe[l]=Be,p=0;p<Se;p+=3){var Re=h[De+p]-ye,_e=h[De+p+1]-ye,Ge=h[De+p+2]-ye;fe[Be++]=2*Re+pe,fe[Be++]=2*_e+pe,fe[Be++]=2*Ge+pe,fe[Be++]=2*Ge+1+pe,fe[Be++]=2*_e+1+pe,fe[Be++]=2*Re+1+pe}for(p=0;p<ve;++p){var Me=p,Ve=(p+1)%ve;fe[Be++]=2*Me+1+pe,fe[Be++]=2*Ve+pe,fe[Be++]=2*Me+pe,fe[Be++]=2*Me+1+pe,fe[Be++]=2*Ve+1+pe,fe[Be++]=2*Ve+pe}te.offset+=2*ve,te.indexOffset=Be,ie[l]=Be-oe[l]}fe=i.IndexDatatype.createTypedArray(ae.length/3,fe);for(var Ye=le.length,He=0;He<Ye;++He){for(var We=le[He].batchIds,ze=0,Ze=We.length,je=0;je<Ze;++je)ze+=ie[We[je]];le[He].count=ze}var qe=U(2===fe.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,w,le);return u.push(ae.buffer,fe.buffer,oe.buffer,ie.buffer,ne.buffer,qe.buffer),{positions:ae.buffer,indices:fe.buffer,indexOffsets:oe.buffer,indexCounts:ie.buffer,batchIds:ne.buffer,packedBuffer:qe.buffer}}))}));
